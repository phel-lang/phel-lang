(ns phel-test\test\core\infinite-seqs
  (:require phel\test :refer [deftest is]))

(deftest test-repeat-infinite
  (is (= [:a :a :a] (take 3 (repeat :a)))
      "(take 3 (repeat :a))"))

(deftest test-repeatedly-infinite
  (is (= [:x :x :x] (take 3 (repeatedly (fn [] :x))))
      "(take 3 (repeatedly (fn [] :x)))"))

(deftest test-iterate
  (is (= [1 2 4 8] (take 4 (iterate (fn [x] (* 2 x)) 1)))
      "(take 4 (iterate (fn [x] (* 2 x)) 1))"))

(deftest test-doall-with-lazy-sequence-from-iterate
  (is (= [1 2 3 4 5] (doall (take 5 (iterate inc 1))))
      "doall should realize lazy sequence and return vector"))

(deftest test-doall-with-lazy-sequence-from-repeat
  (is (= [:a :a :a] (doall (take 3 (repeat :a))))
      "doall should work with repeat"))

(deftest test-doall-with-lazy-sequence-from-repeatedly
  (is (= [:x :x :x] (doall (take 3 (repeatedly (fn [] :x)))))
      "doall should return realized values from repeatedly"))

(deftest test-doall-with-vector
  (is (= [1 2 3] (doall [1 2 3]))
      "doall should return vectors unchanged"))

(deftest test-doall-with-list
  (is (= '(1 2 3) (doall '(1 2 3)))
      "doall should return lists unchanged"))

(deftest test-dorun-with-lazy-sequence-returns-nil
  (is (= nil (dorun (take 5 (iterate inc 1))))
      "dorun should return nil"))

(deftest test-dorun-executes-lazy-sequence
  (is (= nil (dorun (take 5 (repeatedly (fn [] :x)))))
      "dorun should execute lazy sequence and return nil"))

(deftest test-dorun-with-vector-returns-nil
  (is (= nil (dorun [1 2 3]))
      "dorun should return nil for vectors"))

(deftest test-dorun-with-list-returns-nil
  (is (= nil (dorun '(1 2 3)))
      "dorun should return nil for lists"))

(deftest test-doall-with-empty-lazy-sequence
  (is (= nil (doall (take 0 (iterate inc 1))))
      "doall should return nil for empty sequences"))

(deftest test-chained-lazy-operations-with-doall
  (is (= [2 4 6 8 10]
         (doall (take 5 (iterate (fn [x] (+ x 2)) 2))))
      "doall should work with chained lazy operations"))

(deftest test-realized-with-vector
  (is (= true (realized? [1 2 3]))
      "realized? should return true for vectors"))

(deftest test-realized-with-list
  (is (= true (realized? '(1 2 3)))
      "realized? should return true for lists"))

(deftest test-realized-with-lazy-sequence-from-iterate
  (is (= true (realized? (take 5 (iterate inc 1))))
      "realized? returns true for ChunkedSeq (first chunk is always realized)"))

(deftest test-realized-with-lazy-sequence-from-repeat
  (is (= true (realized? (take 3 (repeat :a))))
      "realized? returns true for ChunkedSeq from repeat"))

(deftest test-realized-with-nil
  (is (= true (realized? nil))
      "realized? should return true for nil"))

(deftest test-realized-with-empty-vector
  (is (= true (realized? []))
      "realized? should return true for empty vectors"))

(deftest test-get-on-infinite-lazy-seq
  (is (= 5 (get (iterate inc 0) 5))
      "get should work on infinite lazy sequences without hanging"))

(deftest test-get-on-finite-lazy-seq
  (is (= 2 (get (map inc [1 2 3]) 0))
      "get should work on finite lazy sequences"))

(deftest test-get-on-lazy-seq-out-of-bounds
  (is (= nil (get (map inc [1 2 3]) 10))
      "get should return nil for out of bounds index"))

(deftest test-get-on-lazy-seq-with-default
  (is (= :default (get (map inc [1 2 3]) 10 :default))
      "get should return default value for out of bounds index"))
